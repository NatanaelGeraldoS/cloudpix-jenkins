Set-StrictMode -Version Latest 
$ErrorActionPreference = 'Stop' 
Write-Host "Running PowerShell on $env:COMPUTERNAME as $(whoami)" 
Set-Location #{APP_DIR} 
@' 
BACKEND_IMAGE=#{BACKEND_IMAGE} 
FRONTEND_IMAGE=#{FRONTEND_IMAGE} 
IMAGE_TAG=#{Octopus.Release.Number} 
DD_API_KEY=#{DD_API_KEY}
'@ | Set-Content -Encoding UTF8 .env.production 

@' 
PORT=5000 
ENV_TYPE=Production 
DB_NAME=#{DB_NAME} 
DB_USER=#{DB_USER} 
DB_PASS=#{DB_PASS} 
DB_HOST=#{DB_HOST} 
JWT_SECRET=#{JWT_SECRET} 
'@ | Set-Content -Encoding UTF8 .env.production.backend 

docker compose -f #{COMPOSE_FILE} --env-file .env.production pull 
docker compose -f #{COMPOSE_FILE} --env-file .env.production up -d 
& $env:SystemRoot\System32\curl.exe -fsS http://localhost:5001/healthz > $null